{"version":3,"sources":["../../src/graph_tooltip.js"],"names":["define","$","core","appEvents","GraphTooltip","elem","dashboard","scope","getSeriesFn","self","ctrl","panel","$tooltip","destroy","remove","findHoverIndexFromDataPoints","posX","series","last","ps","datapoints","pointsize","initial","len","points","length","j","lines","steps","Math","max","findHoverIndexFromData","lower","upper","data","middle","floor","renderAndShow","absoluteTime","innerHtml","pos","xMode","html","place_tt","pageX","pageY","getMultiSeriesPlotHoverInfo","seriesList","value","i","hoverIndex","hoverDistance","pointTime","yaxis","results","last_value","minDistance","minTime","legend","hideEmpty","allIsNull","push","hidden","hideZero","allIsZero","x","stack","tooltip","value_type","n","color","label","time","distance","index","concat","mouseleave","shared","plot","detach","unhighlight","emit","bind","event","item","show","panelRelY","offset","top","height","clear","clearCrosshair","plotData","getData","xAxes","getXAxes","options","mode","allSeriesMode","group","hoverInfo","seriesHtml","tooltipFormat","pointOffset","Number","isNaN","left","width","isVisible","window","scrollTop","innerHeight","setCrosshair","sharedCrosshairModeOnly","hasMsResolution","seriesHoverInfo","formatDate","sort","a","b","highlightClass","seriesIndex","formatValue","highlight","datapoint"],"mappings":"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","file":"graph_tooltip.js","sourcesContent":["define([\n  'jquery',\n  'app/core/core',\n],\nfunction ($, core) {\n  'use strict';\n\n  var appEvents = core.appEvents;\n\n  function GraphTooltip(elem, dashboard, scope, getSeriesFn) {\n    var self = this;\n    var ctrl = scope.ctrl;\n    var panel = ctrl.panel;\n\n    var $tooltip = $('<div class=\"graph-tooltip\">');\n\n    this.destroy = function() {\n      $tooltip.remove();\n    };\n\n    this.findHoverIndexFromDataPoints = function(posX, series, last) {\n      var ps = series.datapoints.pointsize;\n      var initial = last*ps;\n      var len = series.datapoints.points.length;\n      for (var j = initial; j < len; j += ps) {\n        // Special case of a non stepped line, highlight the very last point just before a null point\n        if ((!series.lines.steps && series.datapoints.points[initial] != null && series.datapoints.points[j] == null)\n            //normal case\n            || series.datapoints.points[j] > posX) {\n          return Math.max(j - ps,  0)/ps;\n        }\n      }\n      return j/ps - 1;\n    };\n\n    this.findHoverIndexFromData = function(posX, series) {\n      var lower = 0;\n      var upper = series.data.length - 1;\n      var middle;\n      while (true) {\n        if (lower > upper) {\n          return Math.max(upper, 0);\n        }\n        middle = Math.floor((lower + upper) / 2);\n        if (series.data[middle][0] === posX) {\n          return middle;\n        } else if (series.data[middle][0] < posX) {\n          lower = middle + 1;\n        } else {\n          upper = middle - 1;\n        }\n      }\n    };\n\n    this.renderAndShow = function(absoluteTime, innerHtml, pos, xMode) {\n      if (xMode === 'time') {\n        innerHtml = '<div class=\"graph-tooltip-time\">'+ absoluteTime + '</div>' + innerHtml;\n      }\n      $tooltip.html(innerHtml).place_tt(pos.pageX + 20, pos.pageY);\n    };\n\n    this.getMultiSeriesPlotHoverInfo = function(seriesList, pos) {\n      var value, i, series, hoverIndex, hoverDistance, pointTime, yaxis;\n      // 3 sub-arrays, 1st for hidden series, 2nd for left yaxis, 3rd for right yaxis.\n      var results = [[],[],[]];\n\n      //now we know the current X (j) position for X and Y values\n      var last_value = 0; //needed for stacked values\n\n      var minDistance, minTime;\n\n      for (i = 0; i < seriesList.length; i++) {\n        series = seriesList[i];\n\n        if (!series.data.length || (panel.legend.hideEmpty && series.allIsNull)) {\n          // Init value so that it does not brake series sorting\n          results[0].push({ hidden: true, value: 0 });\n          continue;\n        }\n\n        if (!series.data.length || (panel.legend.hideZero && series.allIsZero)) {\n          // Init value so that it does not brake series sorting\n          results[0].push({ hidden: true, value: 0 });\n          continue;\n        }\n\n        hoverIndex = this.findHoverIndexFromData(pos.x, series);\n        hoverDistance = pos.x - series.data[hoverIndex][0];\n        pointTime = series.data[hoverIndex][0];\n\n        // Take the closest point before the cursor, or if it does not exist, the closest after\n        if (! minDistance\n            || (hoverDistance >=0 && (hoverDistance < minDistance || minDistance < 0))\n            || (hoverDistance < 0 && hoverDistance > minDistance)) {\n          minDistance = hoverDistance;\n          minTime = pointTime;\n        }\n\n        if (series.stack) {\n          if (panel.tooltip.value_type === 'individual') {\n            value = series.data[hoverIndex][1];\n          } else if (!series.stack) {\n            value = series.data[hoverIndex][1];\n          } else {\n            last_value += series.data[hoverIndex][1];\n            value = last_value;\n          }\n        } else {\n          value = series.data[hoverIndex][1];\n        }\n\n        // Highlighting multiple Points depending on the plot type\n        if (series.lines.steps || series.stack) {\n          // stacked and steppedLine plots can have series with different length.\n          // Stacked series can increase its length on each new stacked serie if null points found,\n          // to speed the index search we begin always on the last found hoverIndex.\n          hoverIndex = this.findHoverIndexFromDataPoints(pos.x, series, hoverIndex);\n        }\n\n        // Be sure we have a yaxis so that it does not brake series sorting\n        yaxis = 0;\n        if (series.yaxis) {\n          yaxis = series.yaxis.n;\n        }\n\n        results[yaxis].push({\n          value: value,\n          hoverIndex: hoverIndex,\n          color: series.color,\n          label: series.label,\n          time: pointTime,\n          distance: hoverDistance,\n          index: i\n        });\n      }\n\n      // Contat the 3 sub-arrays\n      results = results[0].concat(results[1],results[2]);\n\n      // Time of the point closer to pointer\n      results.time = minTime;\n\n      return results;\n    };\n\n    elem.mouseleave(function () {\n      if (panel.tooltip.shared) {\n        var plot = elem.data().plot;\n        if (plot) {\n          $tooltip.detach();\n          plot.unhighlight();\n        }\n      }\n      appEvents.emit('graph-hover-clear');\n    });\n\n    elem.bind(\"plothover\", function (event, pos, item) {\n      self.show(pos, item);\n\n      // broadcast to other graph panels that we are hovering!\n      pos.panelRelY = (pos.pageY - elem.offset().top) / elem.height();\n      appEvents.emit('graph-hover', {pos: pos, panel: panel});\n    });\n\n    elem.bind(\"plotclick\", function (event, pos, item) {\n      appEvents.emit('graph-click', {pos: pos, panel: panel, item: item});\n    });\n\n    this.clear = function(plot) {\n      $tooltip.detach();\n      plot.clearCrosshair();\n      plot.unhighlight();\n    };\n\n    this.show = function(pos, item) {\n      var plot = elem.data().plot;\n      var plotData = plot.getData();\n      var xAxes = plot.getXAxes();\n      var xMode = xAxes[0].options.mode;\n      var seriesList = getSeriesFn();\n      var allSeriesMode = panel.tooltip.shared;\n      var group, value, absoluteTime, hoverInfo, i, series, seriesHtml, tooltipFormat;\n\n      // if panelRelY is defined another panel wants us to show a tooltip\n      // get pageX from position on x axis and pageY from relative position in original panel\n      if (pos.panelRelY) {\n        var pointOffset = plot.pointOffset({x: pos.x});\n        if (Number.isNaN(pointOffset.left) || pointOffset.left < 0 || pointOffset.left > elem.width()) {\n          self.clear(plot);\n          return;\n        }\n        pos.pageX = elem.offset().left + pointOffset.left;\n        pos.pageY = elem.offset().top + elem.height() * pos.panelRelY;\n        var isVisible = pos.pageY >= $(window).scrollTop() && pos.pageY <= $(window).innerHeight() + $(window).scrollTop();\n        if (!isVisible) {\n          self.clear(plot);\n          return;\n        }\n        plot.setCrosshair(pos);\n        allSeriesMode = true;\n\n        if (dashboard.sharedCrosshairModeOnly()) {\n          // if only crosshair mode we are done\n          return;\n        }\n      }\n\n      if (seriesList.length === 0) {\n        return;\n      }\n\n      if (seriesList[0].hasMsResolution) {\n        tooltipFormat = 'YYYY-MM-DD HH:mm:ss.SSS';\n      } else {\n        tooltipFormat = 'YYYY-MM-DD HH:mm:ss';\n      }\n\n      if (allSeriesMode) {\n        plot.unhighlight();\n\n        var seriesHoverInfo = self.getMultiSeriesPlotHoverInfo(plotData, pos);\n\n        seriesHtml = '';\n\n        absoluteTime = dashboard.formatDate(seriesHoverInfo.time, tooltipFormat);\n\n        // Dynamically reorder the hovercard for the current time point if the\n        // option is enabled.\n        if (panel.tooltip.sort === 2) {\n          seriesHoverInfo.sort(function(a, b) {\n            return b.value - a.value;\n          });\n        } else if (panel.tooltip.sort === 1) {\n          seriesHoverInfo.sort(function(a, b) {\n            return a.value - b.value;\n          });\n        }\n\n        for (i = 0; i < seriesHoverInfo.length; i++) {\n          hoverInfo = seriesHoverInfo[i];\n\n          if (hoverInfo.hidden) {\n            continue;\n          }\n\n          var highlightClass = '';\n          if (item && hoverInfo.index === item.seriesIndex) {\n            highlightClass = 'graph-tooltip-list-item--highlight';\n          }\n\n          series = seriesList[hoverInfo.index];\n\n          value = series.formatValue(hoverInfo.value);\n\n          seriesHtml += '<div class=\"graph-tooltip-list-item ' + highlightClass + '\"><div class=\"graph-tooltip-series-name\">';\n          seriesHtml += '<i class=\"fa fa-minus\" style=\"color:' + hoverInfo.color +';\"></i> ' + hoverInfo.label + ':</div>';\n          seriesHtml += '<div class=\"graph-tooltip-value\">' + value + '</div></div>';\n          plot.highlight(hoverInfo.index, hoverInfo.hoverIndex);\n        }\n\n        self.renderAndShow(absoluteTime, seriesHtml, pos, xMode);\n      }\n      // single series tooltip\n      else if (item) {\n        series = seriesList[item.seriesIndex];\n        group = '<div class=\"graph-tooltip-list-item\"><div class=\"graph-tooltip-series-name\">';\n        group += '<i class=\"fa fa-minus\" style=\"color:' + item.series.color +';\"></i> ' + series.label + ':</div>';\n\n        if (panel.stack && panel.tooltip.value_type === 'individual') {\n          value = item.datapoint[1] - item.datapoint[2];\n        }\n        else {\n          value = item.datapoint[1];\n        }\n\n        value = series.formatValue(value);\n\n        absoluteTime = dashboard.formatDate(item.datapoint[0], tooltipFormat);\n\n        group += '<div class=\"graph-tooltip-value\">' + value + '</div>';\n\n        self.renderAndShow(absoluteTime, group, pos, xMode);\n      }\n      // no hit\n      else {\n        $tooltip.detach();\n      }\n    };\n  }\n\n  return GraphTooltip;\n});\n\nexport {GraphTooltip as GraphTooltip};\n"]}